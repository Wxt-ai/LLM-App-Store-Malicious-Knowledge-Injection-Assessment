import os

def rename_jpg_to_lowercase(directory='.'):
    """
    将指定目录及其子目录中所有 .JPG 文件重命名为 .jpg。
    如果文件已存在（例如，image.jpg 和 image.JPG 同时存在），
    它会跳过重命名，避免覆盖。
    """
    count = 0
    for root, _, files in os.walk(directory):
        for filename in files:
            if filename.lower().endswith('.jpg') and filename.endswith('.JPG'):
                old_path = os.path.join(root, filename)
                new_filename = filename[:-4] + '.jpg' # 替换最后4个字符（.JPG）为.jpg
                new_path = os.path.join(root, new_filename)

                if os.path.exists(new_path) and old_path != new_path:
                    print(f"警告: 文件 '{new_path}' 已存在，跳过重命名 '{old_path}' 以避免覆盖。")
                    continue

                try:
                    os.rename(old_path, new_path)
                    print(f"已重命名: {old_path} -> {new_path}")
                    count += 1
                except OSError as e:
                    print(f"错误: 无法重命名 '{old_path}' -> '{new_path}': {e}")
    print(f"\n操作完成。共重命名了 {count} 个文件。")

if __name__ == "__main__":
    # 示例用法：
    # 1. 重命名当前目录下的文件 (包括子目录)
    print("将重命名当前目录及其子目录中的 .JPG 文件为 .jpg...")
    rename_jpg_to_lowercase('C:/Users/h1419/Desktop/反动')

    # 2. 如果你想指定一个特定的目录，可以这样调用：
    # rename_jpg_to_lowercase('C:/Users/YourUser/Pictures') # Windows 示例
    # rename_jpg_to_lowercase('/home/youruser/photos')     # Linux/macOS 示例